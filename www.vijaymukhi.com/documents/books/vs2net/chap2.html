<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">


<!-- Mirrored from www.vijaymukhi.com/documents/books/vs2net/chap2.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 11 Oct 2024 14:08:07 GMT -->
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="chap2_files/filelist.html">
<link rel=Edit-Time-Data href="chap2_files/editdata.html">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Visual Studio.Net - Controls and Add-ins</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>vmukhi</o:Author>
  <o:LastAuthor>vmukhi</o:LastAuthor>
  <o:Revision>23</o:Revision>
  <o:TotalTime>37</o:TotalTime>
  <o:Created>2002-01-21T06:02:00Z</o:Created>
  <o:LastSaved>2002-01-22T07:02:00Z</o:LastSaved>
  <o:Pages>25</o:Pages>
  <o:Words>7477</o:Words>
  <o:Characters>42619</o:Characters>
  <o:Company>V.M.C.I.</o:Company>
  <o:Lines>355</o:Lines>
  <o:Paragraphs>85</o:Paragraphs>
  <o:CharactersWithSpaces>52339</o:CharactersWithSpaces>
  <o:Version>9.2720</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:553679495 -2147483648 8 0 66047 0;}
@font-face
	{font-family:"Bookman Old Style";
	panose-1:2 5 6 4 5 5 5 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:647 0 0 0 159 0;}
@font-face
	{font-family:"Trebuchet MS";
	panose-1:2 11 6 3 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:7 0 0 0 19 0;}
@font-face
	{font-family:"Monotype Corsiva";
	panose-1:3 1 1 1 1 2 1 1 1 1;
	mso-font-charset:0;
	mso-generic-font-family:script;
	mso-font-pitch:variable;
	mso-font-signature:647 0 0 0 159 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.ILbase, li.ILbase, div.ILbase
	{mso-style-name:ILbase;
	mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Bookman Old Style";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:black;}
p.ILprg, li.ILprg, div.ILprg
	{mso-style-name:ILprg;
	mso-style-parent:ILbase;
	mso-style-next:ILbase;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:9.5pt;
	font-family:"Trebuchet MS";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
p.ILoutput, li.ILoutput, div.ILoutput
	{mso-style-name:ILoutput;
	mso-style-parent:ILbase;
	mso-style-next:ILbase;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:9.5pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
p.ILbullets, li.ILbullets, div.ILbullets
	{mso-style-name:ILbullets;
	mso-style-parent:ILbase;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.3in;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Bookman Old Style";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal><img width=103 height=77 id="_x0000_i1025"
src="bpb.gif"></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:24.0pt;font-family:"Monotype Corsiva";color:black'>2.</span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:24.0pt;font-family:"Monotype Corsiva";color:black'>Creating a
UI Type Editor</span><span style='font-size:20.0pt;font-family:"Monotype Corsiva"'><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This chapter examines certain basic
concepts. There is no law in the world that forbids a dll from being bestowed
with more than one control. The next program demonstrates precisely how it is
possible for a dll to own two controls. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>public class a1 : UserControl</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>public class a2 : UserControl</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>public class a3</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The program a.cs has a total of
three classes.<span style="mso-spacerun: yes">  </span>Out of these classes,
two of them, viz. a1 and a2 have been derived from the class UserControl. Add
the control to the toolbox as demonstrated in the earlier chapter. On doing so,
two separate controls a1 and a2 are conceived, as seen in screen 2.1.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1026"
  src="chap2/1.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.1<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Now, when we click on OK, two
controls with the same bitmap but with distinct names, i.e. a1 and a2 appear in
the General section, as seen in Screen 2.2. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1027"
  src="chap2/2.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.2<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The third class a3 is not
visible, as it has not been derived from class UserControl. By a mere glance at
the toolbox, it is a near impossibility to ascertain as to which dll the
control originate from. Besides, who cares to find that out anyway!<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>If things do not materialize as
expected, simply select the control from the toolbox, click on the right mouse
button and delete it as displayed in screen 2.3. Alternatively, uncheck it from
the Customize Toolbox window.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1028"
  src="chap2/3.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.3<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>On being eradicated from the toolbox,
it also gets displaced from the Customize toolbox dialog. If more than one
control is to be deleted, then each control will have to be axed individually. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff EditValue Start&quot;);</p>

<p class=ILprg>abc(&quot;Value of parameter &quot; + v.ToString());</p>

<p class=ILprg>aaa t = new aaa();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.a1 = (int)v;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>=
(IWindowsFormsEditorService) p.GetService(typeof(IWindowsFormsEditorService));</p>

<p class=ILprg>abc(&quot;Before DropDownControl&quot;);</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>abc(&quot;fff EditValue End&quot;);</p>

<p class=ILprg>return t.a1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle
GetEditStyle(ITypeDescriptorContext c) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff GetEditStyle&quot;);</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff abc&quot;);</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int v = 0;</p>

<p class=ILprg>EventHandler eee;</p>

<p class=ILprg>public aaa() </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;Constructor&quot;);</p>

<p class=ILprg>Size = new System.Drawing.Size(100, 23);</p>

<p class=ILprg>}</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;get a1&quot;);</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;set a1&quot;);</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public event EventHandler fff</p>

<p class=ILprg>{</p>

<p class=ILprg>add </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff event add&quot;);</p>

<p class=ILprg>eee += value;</p>

<p class=ILprg>}</p>

<p class=ILprg>remove</p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff event remove&quot;);</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseDown(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;OnMouseDown&quot;);</p>

<p class=ILprg>v = e.X;</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseUp(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;OnMouseUp&quot;);</p>

<p class=ILprg>eee.Invoke(this, null);</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILoutput><u>a.txt</u></p>

<p class=ILoutput>Constructor</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>set a1</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff EditValue Start</p>

<p class=ILoutput>Value of parameter 7</p>

<p class=ILoutput>Constructor</p>

<p class=ILoutput>fff event add</p>

<p class=ILoutput>set a1</p>

<p class=ILoutput>Before DropDownControl</p>

<p class=ILoutput>OnMouseDown</p>

<p class=ILoutput>OnMouseUp</p>

<p class=ILoutput>fff abc</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff EditValue End</p>

<p class=ILoutput>set a1</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff EditValue Start</p>

<p class=ILoutput>Value of parameter 84</p>

<p class=ILoutput>Constructor</p>

<p class=ILoutput>fff event add</p>

<p class=ILoutput>set a1</p>

<p class=ILoutput>Before DropDownControl</p>

<p class=ILoutput>OnMouseDown</p>

<p class=ILoutput>OnMouseUp</p>

<p class=ILoutput>fff abc</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff EditValue End</p>

<p class=ILoutput>set a1</p>

<p class=ILoutput>get a1</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILoutput>get a1</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Ever heard of this old adage? If
things do not work out the way the book avers, eliminate the control from the
toolbox. Then, restart Visual Studio.Net and add the control to the toolbox.
Whenever there is some activity on the control, the file a.txt also gets
written. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>When the control is initiated
into the form, relevant functions that write to the file a.txt, get called.
Effectively, through the function abc, the file keeps track of the functions
that get called, and also of the sequence in which they are called. Thus, the
function abc is truly a savior and can be used in lieu of the debugger.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Our file reveals that only two
functions get called.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The first function to be called
is the Constructor of the aaa class. It is so because the class is derived from
UserControl and is placed within the form.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Then, there is one property in the
control named a1 and one event called fff. Check the Misc segments of the
properties section in order to verify the above. The get and set accessors get
called innumerable times. Hence, we have not placed the abc functions in the
property a1.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>A click on the property a1
invokes the function GetEditStyle from the class fff. The presence of the
attribute Editor on the property a1 is responsible for summoning the function
GetEditStyle from the class fff. This attribute determines as to what would
shoot up in the editor, while the value of the property in the property window
is being changed. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The property window creates a
new instance of a class, which interacts with the user while the property is
being changed. The user interface may either be a dialog box or a drop-down
window.<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The constructor has two
parameters, both of which are of class Type. The first parameter must be a
class that derives from the class UITypeEditor. The second parameter is the
Type that represents the object that would be created to don the mantle of an
editor class. This is used as a key to locate a specific editor, since the data
type can have more than one editor associated with it. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The class fff is derived from
the class UITypeEditor for the first parameter to the constructor. The second
parameter is the type UITypeEditor. This class provides a base class possessing
some basic functionality to represent a value editor, which can be used as a
user interface for representing and editing values of different data types.
Since we want our own value editor to be used during the design time, we extend
from this class. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Also, there will be occasions
when the value of a property demands a different type of interaction between
the user and the properties window, for which the existing UIs are inadequate. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In such situations, a unique
User Interface can be summoned, which is what we are attempting to achieve
here. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1029"
  src="chap2/4.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.4<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Clicking on the a1 property
displays a drop-down listbox, but with an empty window, as shown in screen 2.4.
However, when the mouse is clicked on the right of the window, the listbox
closes automatically and displays a number as the value of the property. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>You can visualise the window
representing sequence numbers from 0 at one end to 100 at the other.<span
style="mso-spacerun: yes">  </span>The number changes depending upon where you
click, and it gets displayed. Although this may not be the most elegant way of
changing the value of the property, it definitely is an original one.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The first function to be called
is GetEditStyle. This function returns an enum UITypeEditorEditStyle, which
takes three values, viz. DropDown, Modal and None. Here, the value that is
returned is DropDown, since the UI that we want is a drop-down listbox. This
function determines the type of UI that the user shall encounter. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Effect the following
modifications to the return value and rewrite this function as follows:-<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg>public override UITypeEditorEditStyle GetEditStyle(
ITypeDescriptorContext c)<span style="mso-spacerun: yes">  </span>{</p>

<p class=ILprg>abc(&quot;fff GetEditStyle&quot;);</p>

<p class=ILprg>return UITypeEditorEditStyle.Modal;</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The properties window containing
three dots has now replaced the drop-down listbox as shown in screen 2.5.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1030"
  src="chap2/5.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.5<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>When the three dots are clicked
upon, the User Interface that pops up is the same as delineated before. The change
occurs only in the initial method of activation of the user interface.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Now, remove the above function
from the code. This does not affect the framework in any way, since it is then
at liberty to treat the property as an int. Hence, it allows it to be edited. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The function GetEditStyle is
called from the base class, i.e. UITypeEditor class, which merely returns the
enum value None. The functions in the code that display the UI do not get
called at all. Thus, to obtain a user-defined User Interface, the function
GetEditStyle present in UITypeEditor must be overridden.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The next function is EditValue,
which performs all the mundane work. This function is responsible for
displaying the UI. The value that this function returns eventually gets
displayed as the value of the property. The third parameter is the current
value of the property. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thus, the parameter to the
function apprises us what is displayed, while the value that we return is what
the property window would finally display. We now intend to display our User
Interface. We commence by creating a new instance called t of the same class
aaa, which is derived from the class UserControl. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We could have used another class
for the user interface. However, we chose to use the same class aaa. We would
like to employ this object t for our user interface. The constructor of the aaa
class merely sets the Size property to a value that can fit as a window to the
drop-down listbox. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We have an event fff defined in
the control aaa. We hook up a function abc that will be called whenever the
event fff is fired in the control. In the event fff, we store the parameter
value in the Add accessor, which is the function abc from the class fff.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We employ the EventHandler eee
to keep track of all the code that gets added or removed. The Remove accessor
contains no code, since it is not called at all. Thus, whenever the aaa control
calls the Invoke function of the delegate eee, the function abc shall get
called in the class fff. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The property concept remains
unchanged irrespective of the user interface associated with it. The set
accessor of the property must be initialized whenever its value is changed,
while the get accessor must be used to fetch the value. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The property a1 is initialized
using the last parameter of the function. The value is stored in the variable
v, in order that it may be utilised by others too. Since the program is not
coded in a manner that allows for the variable to be used elsewhere, this step
remains optional. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Now that the control has finally
been instantiated, we intend to display this control in the properties window. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We need access to some object
that would display our control in the drop-down listbox. Towards this end, the
second parameter to the function, i.e. the IServiceProvider type parameter p,
comes into play. Only those classes that wish to render some service to other
classes implement this interface. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>There are only four classes that
implement this interface. These are HttpContext, LicenseContext,
MarshallByValueComponent and ServiceContainer. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This interface has a single
function named GetService, which can fetch the object whose services are to be
obtained. The single parameter to the function is the type of Object. It is
given in the interface of IWindowsFormsEditorService. The classes derived from
this interface have the requisite familiarity of working with custom user
interfaces. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The function DropDownControl is
well appraised of how a control is to be displayed as a window in the properties
toolbox. When this function is executed, an empty window gets displayed, with
the drop-down listbox in the properties window. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thereafter, when the right mouse
button is clicked in the window, the function OnMouseDown gets invoked in the
control aaa. The OnMouseDown function gets called with a single parameter e of
type MouseEventArgs. The variable v is utilised to store the current value of
the property. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This parameter has a property x,
which contains the position in pixels on the horizontal or along the X axis,
where the mouse button is clicked. In our case, the maximum value is decided by
the Size property and it does not exceed 100 pixels. This value is stored in
the variable v, so that whenever the get accessor is called next, this value can
be returned. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>On releasing the mouse button,
the function OnMouseUp gets triggered. At this point in time, the control can
infer that the user has made a choice, and hence, the drop-down window needs to
be closed. Thus, this function should be responsible for closing the control
window. However, the problem at this juncture is that there is no access to the
class fff. In order to grapple with this problem, the event fff is set. Thus,
it can be fired and the abc function can be called in the class fff. This
function shall shut the window down. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>So, all that transpires in the
function OnMouseDown is that, the Invoke function is used to call the function
abc. This object is supplied as the first parameter and a null is provided to
the EventArgs object. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This will now call the function
abc in the class fff. We are fully aware of the fact that there are two
functions, both named abc in the class fff. However, both these functions
possess distinct parameters. Each one of us is blessed with distinct tastes and
personal preferences when it comes to naming his/her favourite object. In our
case, we have a soft spot for the function name abc. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In the abc function, the
IWindowsFormsEditorService object e is used to close the drop-down listbox by
calling the function CloseDropDown. This will ensure that whenever the mouse
button is released, the listbox would close. The function DropDownControl waits
at its position, displaying the dropdown listbox, until the function
CloseDropDown is called. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In the OnMouseDown function, the
variable v has already been initialized. Thus, when the value of the property
a1 is returned, effectively, it is the value of the variable v that is being
returned. Thereafter, this value is displayed by the properties window.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The output file a.txt, minus the
'get' accessor's as corroborates our act. After we reach the End of the
EditValue, the remainder of the a.txt is a mere repetition of the earlier part.
As is evident from the file, the whole process gets repeated, beginning with
the GetEditStyle.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;fff EditValue Start&quot;);</p>

<p class=ILprg>abc(&quot;Value of parameter &quot; + v.ToString());</p>

<p class=ILprg>bbb t = new bbb();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.b1 = (int)v;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>=
(IWindowsFormsEditorService) p.GetService(typeof(IWindowsFormsEditorService));</p>

<p class=ILprg>abc(&quot;Before DropDownControl&quot;);</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>abc(&quot;fff EditValue End&quot;);</p>

<p class=ILprg>return t.b1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle
GetEditStyle(ITypeDescriptorContext c) {</p>

<p class=ILprg>abc(&quot;fff GetEditStyle&quot;);</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) {</p>

<p class=ILprg>abc(&quot;fff abc&quot;);</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int v = 0;</p>

<p class=ILprg>public aaa() </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;aaa Constructor&quot;);</p>

<p class=ILprg>}</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>class bbb : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int w = 0;</p>

<p class=ILprg>EventHandler eee;</p>

<p class=ILprg>public bbb() </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;bbb Constructor&quot;);</p>

<p class=ILprg>Size = new System.Drawing.Size(100, 23);</p>

<p class=ILprg>}</p>

<p class=ILprg>public int b1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return w;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>w = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public event EventHandler fff</p>

<p class=ILprg>{</p>

<p class=ILprg>add </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;bbb fff event add&quot;);</p>

<p class=ILprg>eee += value;</p>

<p class=ILprg>}</p>

<p class=ILprg>remove</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseDown(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;bbb OnMouseDown&quot;);</p>

<p class=ILprg>w = e.X;</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseUp(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;bbb OnMouseUp&quot;);</p>

<p class=ILprg>eee.Invoke(this, null);</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILoutput><u>a.txt</u></p>

<p class=ILoutput>aaa Constructor</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILoutput>fff EditValue Start</p>

<p class=ILoutput>Value of parameter 3</p>

<p class=ILoutput>bbb Constructor</p>

<p class=ILoutput>bbb fff event add</p>

<p class=ILoutput>Before DropDownControl</p>

<p class=ILoutput>bbb OnMouseDown</p>

<p class=ILoutput>bbb OnMouseUp</p>

<p class=ILoutput>fff abc</p>

<p class=ILoutput>fff EditValue End</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILoutput>fff EditValue Start</p>

<p class=ILoutput>Value of parameter 88</p>

<p class=ILoutput>bbb Constructor</p>

<p class=ILoutput>bbb fff event add</p>

<p class=ILoutput>Before DropDownControl</p>

<p class=ILoutput>bbb OnMouseDown</p>

<p class=ILoutput>bbb OnMouseUp</p>

<p class=ILoutput>fff abc</p>

<p class=ILoutput>fff EditValue End</p>

<p class=ILoutput>fff GetEditStyle</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The earlier program has been
simplified in this program. Although it still performs the same task, it now
incorporates two separate classes. The class aaa is public and represents the
control. It contains code that solely relates to the control.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The user-interface code has been
placed in another class named bbb. Thus, all that we have is a property a1,
along with the variable v to store its value. The abc function does not
contribute to the control. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The constructor in the aaa class
is summoned at the very beginning, followed by the get and set accessors. The
function EditValue creates an object, which has a likeness to the bbb class and
not to the aaa class. Other than changing the name of the property from a1 to
b1, all the code in the class fff remains unaltered.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The class bbb is not public, and
hence, the default access modifier is internal. Thus, this class can be
accessed and is visible to other classes present within the dll named a.dll.
The constructor initializes the Size property, thereby determining the size of
the window. The property b1 simply uses the variable 'w' to maintain state. The
Mouse functions also remain unchanged. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thus, by separating the User Interface
Editor code in the class bbb from the code of the control, it becomes much
easier to distinguish between the code relevant to the control and the code
pertaining to the UI type editor.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Henceforth, any changes that are
incorporated to the control shall be visible in the class aaa, and any window
related modification that gets displayed with a click on the drop-down list
button shall be viewed in the class bbb. Finally, the class that handles the UI
Type Editor shall be sighted in the class fff.<span style="mso-spacerun: yes"> 
</span>If there is no change in the class, it can be copied from the earlier
program. However, when a class changes, it would be displayed in full.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In the ensuing program, we have
not provided the code of the bbb class, since it remains unaltered. So, kindly
retain the same code as was sighted in the previous program.<span
style="mso-spacerun: yes">  </span>Also, the abc function has been removed from
the program, since there is no necessity to trace out the functions that are
called. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>bbb t = new bbb();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.b1 = (int)v;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>= (IWindowsFormsEditorService)p.GetService(typeof(IWindowsFormsEditorService));</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>return t.b1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle
GetEditStyle(ITypeDescriptorContext c) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>if ( a.UIType == yyy.DropDown)</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>if ( a.UIType == yyy.Modal)</p>

<p class=ILprg>return UITypeEditorEditStyle.Modal;</p>

<p class=ILprg>return UITypeEditorEditStyle.None;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int v ;</p>

<p class=ILprg>yyy w = yyy.DropDown;</p>

<p class=ILprg>public yyy UIType</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return w;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>w = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public enum yyy</p>

<p class=ILprg>{</p>

<p class=ILprg>DropDown, Modal, None</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This program has an enum yyy
that takes three values, viz. the option that the UI Type Editor offers for a
user interface, i.e. a drop-down listbox, a Modal dialog box and None. Yet
another property called UIType is created in the control class, and its type is
set to the enum yyy. The variable w stores the value of the property and the
default option is set to DropDown. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The real action lies in the
function GetEditStyle. This function is passed a parameter named c of type
ITypeDescriptorContext. This interface is also passed to the function
EditValue. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This interface is of
considerable significance since it has a member called Instance, which<span
style="mso-spacerun: yes">  </span>actually is an instance of the control for
which the UI Editor is being created. Thus, in this particular case, the
instance is that of the class aaa. Therefore, using this object 'a', the value
of the property UIType is ascertained, and depending upon its value, a
different EditStyle is returned. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1031"
  src="chap2/6.jpg"><o:p></o:p></p>
  </td>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1032"
  src="chap2/7.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.6<o:p></o:p></p>
  </td>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.7<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thus, screens 2.6 and 2.7 reveal
how the User Interface for the property can be dynamically modified. If things
do not get updated dynamically, click outside the control, and then, select the
control once again. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The vital point brought out by
the above program is that, at any given time, this control can be accessed in
the class fff by using the ITypeDescriptorContext parameter. In turn, the
control can run code in the class fff by firing an event.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>Form f = new Form();</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>=
(IWindowsFormsEditorService) p.GetService(typeof(IWindowsFormsEditorService));</p>

<p class=ILprg>if ( a.UIType == yyy.DropDown)</p>

<p class=ILprg>{</p>

<p class=ILprg>bbb t = new bbb();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.b1 = (int)v;</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>return t.b1;</p>

<p class=ILprg>}</p>

<p class=ILprg>else if (a.UIType == yyy.Modal)</p>

<p class=ILprg>{</p>

<p class=ILprg>Button b = new Button ();</p>

<p class=ILprg>TextBox t = new TextBox();</p>

<p class=ILprg>b.Text = &quot;OK&quot;;</p>

<p class=ILprg>b.Location = new Point (10, 10);</p>

<p class=ILprg>b.Click += new EventHandler(pqr);</p>

<p class=ILprg>t.Location = new Point (10, 100);</p>

<p class=ILprg>t.Text = a.a1.ToString();</p>

<p class=ILprg>f.Text = &quot;Vijay's Dialog Box&quot;;</p>

<p class=ILprg>f.Controls.Add(b);</p>

<p class=ILprg>f.Controls.Add(t);</p>

<p class=ILprg>e.ShowDialog(f);</p>

<p class=ILprg>string s = t.Text;</p>

<p class=ILprg>return Convert.ToInt32(s);</p>

<p class=ILprg>}</p>

<p class=ILprg>else</p>

<p class=ILprg>return 0;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext
c) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>if ( a.UIType == yyy.DropDown)</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>if ( a.UIType == yyy.Modal)</p>

<p class=ILprg>return UITypeEditorEditStyle.Modal;</p>

<p class=ILprg>return UITypeEditorEditStyle.None;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>void pqr(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>f.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Once again, since the window
shown in the UI remains unchanged, the code for the class bbb is not exhibited.
The user control class aaa<span style="mso-spacerun: yes">  </span>is also not
displayed, since the control requires no modification. All the amendments have
been effected in the fff class. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The function GetEditStyle does
not undergo any change whatsoever. It returns an enum value, depending upon the
value of the property UIType. The modifications have been incorporated in the
function EditValue. The value contained in the property UIType is determined
using the first parameter c of type ITypeDescriptorContext. If its value is
DropDown, then the task performed earlier is resorted to once again. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>If it is Modal, then a Form
object is created, which is subsequently populated with a Button and a TextBox.
The form object f is an instance variable. So, other functions in the class fff
can access this variable. The Location property of the textbox and button are
set to some decent values and the Click event of the button is associated with
the function pqr. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The function simply closes the
dialog box using the Close function and not the CloseDropDown function. The
TextBox control t is initialized to the current value of the control property
a1. The ShowDialog function is then called with the form object f as a
parameter. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In Visual Studio.Net, modify the
UIType property to Modal and click anywhere outside the control. Then, select
the control again. Now, when the property a1 is clicked upon, the three dots
become visible, which when clicked on, display screen 2.8. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=300 height=300 id="_x0000_i1033"
  src="chap2/8.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.8<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The textbox displays the value
of the property. Now, change the value from 85 to 850 and click on OK. This
closes the Dialog box, since the ShowDialog function terminates. We use the
static function ToInt32 from the Convert class to convert the string content of
the textbox into a number and to return this value. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This value is thereafter
displayed in the properties window. The last 'else' is not deemed necessary,
since the UIType of None will never call the function EditValue. This is a
classic example of how we can build our own unique UI Type editors.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>Form f = new Form();</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>=
(IWindowsFormsEditorService)p.GetService(typeof(IWindowsFormsEditorService));</p>

<p class=ILprg>bbb t = new bbb();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.b1 = (int)v;</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>return t.b1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override bool
GetPaintValueSupported(ITypeDescriptorContext c)</p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;GetPaintValueSupported&quot;);</p>

<p class=ILprg>return true;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override void PaintValue(PaintValueEventArgs e)</p>

<p class=ILprg>{</p>

<p class=ILprg>abc(&quot;PaintValue&quot;);</p>

<p class=ILprg>Graphics g = e.Graphics;</p>

<p class=ILprg>Rectangle r = e.Bounds;</p>

<p class=ILprg>abc(r.ToString());</p>

<p class=ILprg>object o = e.Value;</p>

<p class=ILprg>int i = (int)o;</p>

<p class=ILprg>abc(&quot;Value from PaintEventArgs &quot; + i.ToString());</p>

<p class=ILprg>ITypeDescriptorContext c = e.Context;</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>abc(&quot;Value from Control &quot; + a.a1.ToString());</p>

<p class=ILprg>Brush b = new SolidBrush(Color.Red);</p>

<p class=ILprg>Font f = new Font(&quot;Times New Roman&quot;, 10);</p>

<p class=ILprg>g.DrawString(i.ToString(), f, b , r);</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext
c) </p>

<p class=ILprg>{</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int v ;</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>class bbb : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int w = 0;</p>

<p class=ILprg>EventHandler eee;</p>

<p class=ILprg>public bbb() </p>

<p class=ILprg>{</p>

<p class=ILprg>Size = new System.Drawing.Size(100, 23);</p>

<p class=ILprg>}</p>

<p class=ILprg>public int b1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return w;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>w = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public event EventHandler fff</p>

<p class=ILprg>{</p>

<p class=ILprg>add </p>

<p class=ILprg>{</p>

<p class=ILprg>eee += value;</p>

<p class=ILprg>}</p>

<p class=ILprg>remove</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseDown(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>w = e.X;</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseUp(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>eee.Invoke(this, null);</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILoutput><u>a.txt</u></p>

<p class=ILoutput>GetPaintValueSupported</p>

<p class=ILoutput>PaintValue</p>

<p class=ILoutput>{X=1,Y=1,Width=20,Height=14}</p>

<p class=ILoutput>Value from PaintEventArgs 56</p>

<p class=ILoutput>Value from Control 56</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The entire program has been
displayed, despite no changes being incorporated in the classes aaa and bbb.
The UIType property and the enum yyy have been completely eliminated. Bear in
mind that if things do not work as specified, remove the control aaa from the
toolbox, restart the framework and add the Control again. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The program introduces a new
function named GetPaintValueSupported, which takes a ITypeDescriptorContext
parameter. This facilitates access to the object. This function gets called so
often that the framework is able to discern whether the function called
PaintValue has been implemented or not. A value of 'true' indicates that a
function by that name is present in the class fff. The default value that is
returned is 'false'. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Life is all about giving and
taking. And sharing is a virtue.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The PaintValue function writes
into the properties window. The content or value of the function is written
here. Thus, it is possible to add what we desire into a small window that is offered
to us, just prior to the properties window displaying the value of the
property. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The documentation clearly states
that there are two functions, both named GetPaintValueSupported, but only one
of them is capable of being used. This is because, the one without any
parameter is not marked as 'virtual', and hence, it cannot be overriden. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The PaintValue function gets
called with a parameter PaintValueEventArgs, which contains everything that is required
to write into the properties window. To write to any window, a graphics object
is needed. The Graphics property of the parameter e returns an object of type
Graphics. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The Bound property is used to
return a rectangle, which returns the dimensions of the window into which the
contents are to be written.<span style="mso-spacerun: yes">  </span>The Value
property contains the value that would be displayed in the properties window by
Visual Studio.Net. The file a.txt verifies that the window that has been
provided is very small.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Finally, the Context property is
used to access the ITypeDescriptorContext object. The instance property is
obtained from this object to access the control. Further, the value of the a1
property is written. It is but obvious that the value property and the value of
property a1 shall be the same.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The next task is to write to the
window. So, a Red brush is created alongwith a Font object, which is assigned
the name of the Font and the Font Size. The dependable DrawString function is
used to write to the window. The screen 2.9 reveals the tiny window that
contains the text that is to be displayed, however, we have drawn a small
picture instead.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1034"
  src="chap2/9.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.9<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c, IServiceProvider
o, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>PropertyDescriptor p = c.PropertyDescriptor;</p>

<p class=ILprg>Type t = p.PropertyType;</p>

<p class=ILprg>abc(t.ToString());</p>

<p class=ILprg>abc(p.DisplayName);</p>

<p class=ILprg>abc(p.Category);</p>

<p class=ILprg>abc(p.ComponentType.ToString());</p>

<p class=ILprg>IContainer co = c.Container;</p>

<p class=ILprg>abc(co.ToString());</p>

<p class=ILprg>ComponentCollection coc = co.Components ;</p>

<p class=ILprg>abc(coc.Count.ToString());</p>

<p class=ILprg>IComponent c1 = coc[0];</p>

<p class=ILprg>abc(c1.ToString());</p>

<p class=ILprg>c1 = coc[1];</p>

<p class=ILprg>abc(c1.ToString());</p>

<p class=ILprg>aaa a = (aaa)coc[1];</p>

<p class=ILprg>abc(a.a1.ToString());</p>

<p class=ILprg>return 100;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext
c) </p>

<p class=ILprg>{</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILoutput><u>a.txt</u></p>

<p class=ILoutput>System.Int32</p>

<p class=ILoutput>a1</p>

<p class=ILoutput>Misc</p>

<p class=ILoutput>aaa</p>

<p class=ILoutput>Microsoft.VisualStudio.Designer.Host.DesignerHost</p>

<p class=ILoutput>2</p>

<p class=ILoutput>Form1 , Text: Form1</p>

<p class=ILoutput>aaa1 [aaa]</p>

<p class=ILoutput>56</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1035"
  src="chap2/10.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.10<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The abc function with the ee
object has been deleted from the program code. Moreover, in the EditValue function,
a value of 100 is returned in lieu of a listbox . Here, the aaa and the bbb
classes are not shown, since they have not been modified. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The ITypeDescriptorContext
parameter contains two properties, which have not been touched upon so far. So,
we shall check them out prior to moving ahead. We start off with the property
PropertyDescriptor. This property and its type have the same name, i.e.
PropertyDescriptor. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The property PropertyType has
the type of Type. When the string representation of the type is displayed, it
becomes evident that the property is of type Int32 or int. Thus, the
PropertyDescriptor property is the one that encapsulates all information
related to our property a1. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The DisplayName property assigns
the name a1, which is used by the property window. The Category property
specifies the category that the property is placed in, i.e. Misc. The
ComponentType property is obviously of type aaa, which is the type of our
control. The last property of the ITypeDescriptorContext interface is Container.
<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The Container property is of
type Container. On displaying its string value, we obtain the name of the
class, viz. DesignerHost. This class manages all the controls that the user
places in it.<span style="mso-spacerun: yes">  </span>Also, this class represents
the form which has two controls, viz. a Form1 and our control aaa.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The IContainer interface has a
property named Components of type ComponentCollection that iterates through all
the components that are present. The Count member gives a count of two, since
there happen to be two components. The indexer can be used to access each and
every component. The first component is the Form1. We have displayed its string
representation.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The second component is the
control aaa.<span style="mso-spacerun: yes">  </span>We cast the IComponent
object c1 to an aaa object and display the value of the property a1. This value
gets displayed in the property window. Thus, using the Container property, one
can delve into the innards of Visual Studio.Net Designer. More details on this
shall be tendered later.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>= <span
style='font-size:9.0pt'>(IWindowsFormsEditorService)p.GetService(typeof(IWindowsFormsEditorService));</span></p>

<p class=ILprg>bbb t = new bbb();</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.b1 = (int)v;</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>a.a1 = t.b1;</p>

<p class=ILprg>return t.b1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext
c) </p>

<p class=ILprg>{</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int v ;</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnPaint(PaintEventArgs e)</p>

<p class=ILprg>{</p>

<p class=ILprg>Graphics g = e.Graphics;</p>

<p class=ILprg>Brush b = new SolidBrush(ForeColor);</p>

<p class=ILprg>g.DrawString(&quot;vijay&quot; + a1.ToString(), Font , b ,
ClientRectangle);</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>class bbb : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>int w = 0;</p>

<p class=ILprg>EventHandler eee;</p>

<p class=ILprg>public bbb() </p>

<p class=ILprg>{</p>

<p class=ILprg>Size = new System.Drawing.Size(100, 123);</p>

<p class=ILprg>}</p>

<p class=ILprg>public int b1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return w;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>w = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public event EventHandler fff</p>

<p class=ILprg>{</p>

<p class=ILprg>add </p>

<p class=ILprg>{</p>

<p class=ILprg>eee += value;</p>

<p class=ILprg>}</p>

<p class=ILprg>remove</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseDown(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>w = e.X;</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseUp(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>eee.Invoke(this, null);</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnPaint(PaintEventArgs e)</p>

<p class=ILprg>{</p>

<p class=ILprg>Graphics g = e.Graphics;</p>

<p class=ILprg>Brush b = new SolidBrush(ForeColor);</p>

<p class=ILprg>g.DrawString(b1.ToString(), Font , b , ClientRectangle);</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1036"
  src="chap2/11.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.11<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>To facilitate your comprehension
of this program with effortless ease, we urge you to examine the output shown
in screen 2.11.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>To begin with, the text
displayed in the control window is vijay0. When we click on the drop-down
listbox, the value of the property a1, i.e. 0, is displayed. Thus, this example
demonstrates how the text can be displayed in both, the control and the
drop-down listbox. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We are aware of your familiarity
with the fact that the class aaa represents the control.<span
style="mso-spacerun: yes">  </span>To enable the control to display something,
the OnPaint function is employed, wherein the text is displayed using the
DrawString function. Not only do we display a standard boilerplate text like
'vijay', but also the property a1.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This property a1 is initialized
by the EditValue function in class fff. This property had also remained
uninitialized in the earlier program. It is the OnMouseDown function that sets
the value of the property b1 in the class bbb. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The OnPaint function influences
the appearance of the window. This OnPaint function is added to the class bbb.
Thus, the value of the property b1 is displayed when the drop-down listbox is
clicked upon. There is no new feature that necessitates an explanation here.
You are merely required to override the OnPaint function to render a fresh look
to the window.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The Size property is used to
determine the size of the drop-down window. The height of the Font, which is
used to draw the object, can be used to place options on multiple lines. In the
OnMouseUp function, the Y property is employed to figure out the option that
has been chosen. We save it as an exercise for our readers, to mentally grapple
with on a rainy day.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILprg><u>a.cs</u></p>

<p class=ILprg>using System;</p>

<p class=ILprg>using System.IO;</p>

<p class=ILprg>using System.ComponentModel;</p>

<p class=ILprg>using System.ComponentModel.Design;</p>

<p class=ILprg>using System.Diagnostics;</p>

<p class=ILprg>using System.Drawing;</p>

<p class=ILprg>using System.Drawing.Drawing2D;</p>

<p class=ILprg>using System.Drawing.Design;</p>

<p class=ILprg>using System.Windows.Forms;</p>

<p class=ILprg>using System.Windows.Forms.ComponentModel;</p>

<p class=ILprg>using System.Windows.Forms.Design;</p>

<p class=ILprg>public class fff : System.Drawing.Design.UITypeEditor </p>

<p class=ILprg>{</p>

<p class=ILprg>IWindowsFormsEditorService e = null;</p>

<p class=ILprg>public override object EditValue(ITypeDescriptorContext c,
IServiceProvider p, object v) </p>

<p class=ILprg>{</p>

<p class=ILprg>aaa a = (aaa)c.Instance;</p>

<p class=ILprg>e<span style="mso-spacerun: yes">  </span>= <span
style='font-size:9.0pt'>(IWindowsFormsEditorService)p.GetService(typeof(IWindowsFormsEditorService));</span></p>

<p class=ILprg>aaa t = new aaa();</p>

<p class=ILprg>t.cs = a.cs;</p>

<p class=ILprg>t.ce = a.ce;</p>

<p class=ILprg>t.final = a.final;</p>

<p class=ILprg>t.textl = a.textl;</p>

<p class=ILprg>t.Fontl = a.Fontl;</p>

<p class=ILprg>t.fff += new EventHandler(abc);</p>

<p class=ILprg>t.a1 = (int)v;</p>

<p class=ILprg>e.DropDownControl(t);</p>

<p class=ILprg>return t.a1;</p>

<p class=ILprg>}</p>

<p class=ILprg>public override UITypeEditorEditStyle
GetEditStyle(ITypeDescriptorContext c) </p>

<p class=ILprg>{</p>

<p class=ILprg>return UITypeEditorEditStyle.DropDown;</p>

<p class=ILprg>}</p>

<p class=ILprg>void abc(object s, EventArgs e1) </p>

<p class=ILprg>{</p>

<p class=ILprg>e.CloseDropDown();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public class aaa : System.Windows.Forms.UserControl </p>

<p class=ILprg>{</p>

<p class=ILprg>EventHandler eee;</p>

<p class=ILprg>int dv = 0;</p>

<p class=ILprg>Font f1 = new Font(&quot;Times Roman&quot;, 10);</p>

<p class=ILprg>public Color cs = Color.Red;</p>

<p class=ILprg>public Color ce = Color.LimeGreen;</p>

<p class=ILprg>public Color cf = Color.Blue;</p>

<p class=ILprg>Brush bb = null;</p>

<p class=ILprg>Brush bd = null;</p>

<p class=ILprg>string z = &quot;vijay&quot;;</p>

<p class=ILprg>public aaa() </p>

<p class=ILprg>{</p>

<p class=ILprg>Size = new System.Drawing.Size(100, 23);</p>

<p class=ILprg>}</p>

<p class=ILprg>int v ;</p>

<p class=ILprg>[Editor(typeof(fff), typeof(UITypeEditor))]</p>

<p class=ILprg>public int a1</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return v;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>v = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public Color start </p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return cs;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>cs = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public Color end</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return ce;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>ce = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public Color final</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return cf;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>cf = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public string textl</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return z;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>z = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public Font Fontl</p>

<p class=ILprg>{</p>

<p class=ILprg>get </p>

<p class=ILprg>{</p>

<p class=ILprg>return f1;</p>

<p class=ILprg>}</p>

<p class=ILprg>set </p>

<p class=ILprg>{</p>

<p class=ILprg>f1 = value;</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>public event EventHandler fff</p>

<p class=ILprg>{</p>

<p class=ILprg>add </p>

<p class=ILprg>{</p>

<p class=ILprg>eee += value;</p>

<p class=ILprg>}</p>

<p class=ILprg>remove</p>

<p class=ILprg>{</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseDown(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>base.OnMouseDown(e);</p>

<p class=ILprg>abc(&quot;OnMouseDown e.X=&quot; + e.X.ToString());</p>

<p class=ILprg>float p = (float)e.X / (float)ClientRectangle.Width * 100;</p>

<p class=ILprg>abc(&quot;OnMouseDown p=&quot; + p.ToString());</p>

<p class=ILprg>dv = (int)p;</p>

<p class=ILprg>Invalidate();</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnMouseUp(MouseEventArgs e) </p>

<p class=ILprg>{</p>

<p class=ILprg>base.OnMouseUp(e);</p>

<p class=ILprg>a1 = dv;</p>

<p class=ILprg>eee.Invoke(this, null);</p>

<p class=ILprg>}</p>

<p class=ILprg>protected override void OnPaint(PaintEventArgs e)</p>

<p class=ILprg>{</p>

<p class=ILprg>base.OnPaint(e);</p>

<p class=ILprg>abc(ClientSize.ToString());</p>

<p class=ILprg>bb=new LinearGradientBrush(new Point(0, 0), new Point(ClientSize.Width,
0),cs,ce);</p>

<p class=ILprg>abc(ClientRectangle.ToString());</p>

<p class=ILprg>e.Graphics.FillRectangle(bb, ClientRectangle);</p>

<p class=ILprg>Rectangle r = ClientRectangle;</p>

<p class=ILprg>float p = ((float)a1 / (float)100);</p>

<p class=ILprg>abc(&quot;a1= &quot; + a1.ToString() + &quot; p= &quot; +
p.ToString());</p>

<p class=ILprg>int a = (int)(p * (float)r.Width);</p>

<p class=ILprg>abc(&quot;a= &quot; + a.ToString());</p>

<p class=ILprg>r.X += a;</p>

<p class=ILprg>r.Width -= a;</p>

<p class=ILprg>abc(&quot;r.X= &quot; + r.X.ToString() + &quot; r.Width= &quot;
+ r.Width.ToString());</p>

<p class=ILprg>bd = new SolidBrush(cf);</p>

<p class=ILprg>abc(r.ToString());</p>

<p class=ILprg>e.Graphics.FillRectangle(bd, r);</p>

<p class=ILprg>e.Graphics.Flush();</p>

<p class=ILprg>RectangleF r1 = new Rectangle();</p>

<p class=ILprg>SizeF ts = e.Graphics.MeasureString(textl, Fontl);</p>

<p class=ILprg>abc(&quot;ts= &quot; + ts.ToString());</p>

<p class=ILprg>r1.Width = ts.Width;</p>

<p class=ILprg>r1.Height = ts.Height;</p>

<p class=ILprg>r1.X = (ClientRectangle.Width - r1.Width) / 2;</p>

<p class=ILprg>r1.Y = (ClientRectangle.Height - r1.Height) / 2;</p>

<p class=ILprg>abc(&quot;r1= &quot; + r1.ToString());</p>

<p class=ILprg>e.Graphics.DrawString(textl, Fontl, new SolidBrush(Color.White),
r1);</p>

<p class=ILprg>}</p>

<p class=ILprg>public void abc(string s)</p>

<p class=ILprg>{</p>

<p class=ILprg>FileStream fs = new FileStream(&quot;c:\\a1\\a.txt&quot;,
FileMode.Append, FileAccess.Write);</p>

<p class=ILprg>StreamWriter w = new StreamWriter(fs);</p>

<p class=ILprg>w.WriteLine(s);</p>

<p class=ILprg>w.Flush();</p>

<p class=ILprg>w.Close();</p>

<p class=ILprg>}</p>

<p class=ILprg>}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILoutput><u>a.txt</u></p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 0 p= 0</p>

<p class=ILoutput>a= 0</p>

<p class=ILoutput>r.X= 0 r.Width= 100</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>OnMouseDown e.X=89</p>

<p class=ILoutput>OnMouseDown p=89</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 89 p= 0.89</p>

<p class=ILoutput>a= 88</p>

<p class=ILoutput>r.X= 88 r.Width= 12</p>

<p class=ILoutput>{X=88,Y=0,Width=12,Height=23}</p>

<p class=ILoutput>ts= {Width=32.08116, Height=16.75781}</p>

<p class=ILoutput>r1= {X=33.95942,Y=3.121095,Width=32.08116,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 89 p= 0.89</p>

<p class=ILoutput>a= 88</p>

<p class=ILoutput>r.X= 88 r.Width= 12</p>

<p class=ILoutput>{X=88,Y=0,Width=12,Height=23}</p>

<p class=ILoutput>ts= {Width=39.64626, Height=16.75781}</p>

<p class=ILoutput>r1= {X=30.17687,Y=3.121095,Width=39.64626,Height=16.75781}</p>

<p class=ILoutput>{Width=100, Height=23}</p>

<p class=ILoutput>{X=0,Y=0,Width=100,Height=23}</p>

<p class=ILoutput>a1= 89 p= 0.89</p>

<p class=ILoutput>a= 88</p>

<p class=ILoutput>r.X= 88 r.Width= 12</p>

<p class=ILoutput>{X=88,Y=0,Width=12,Height=23}</p>

<p class=ILoutput>ts= {Width=39.64626, Height=16.75781}</p>

<p class=ILoutput>r1= {X=30.17687,Y=3.121095,Width=39.64626,Height=16.75781}</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The optimum approach of
appreciating the above example is by scanning its output. Here, the control
displays a host of colors. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><img width=400 height=300 id="_x0000_i1037"
  src="chap2/12.jpg"><o:p></o:p></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal>Screen 2.12<o:p></o:p></p>
  </td>
 </tr>
</table>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Next, click on the property a1.
The screen 2.12 emerges with the drop-down listbox. Let us spend some time
discerning and appreciating the riot of colors that meets the eye. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The program has five properties.
These properties are as follows:-<o:p></o:p></span></p>

<p class=ILbullets><span style='mso-bidi-font-size:12.0pt;font-family:"Times New Roman"'><span
style='mso-tab-count:1'>     </span></span>Three color properties- end, final
and start.</p>

<p class=ILbullets><span style='mso-bidi-font-size:12.0pt;font-family:"Times New Roman"'><span
style='mso-tab-count:1'>     </span></span>A string property- textl.</p>

<p class=ILbullets><span style='mso-bidi-font-size:12.0pt;font-family:"Times New Roman"'><span
style='mso-tab-count:1'>     </span></span>A font property - Font1</p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Variables are also present,
which store the values of these properties. Therefore, the properties and the
variables can be used interchangeably, although we are aware that this is not
the correct approach. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Let us begin with the first
function that gets called, i.e. the OnPaint function. This function is
responsible for the display of the myriad colors in the control, as also in the
UI type editor. It is for this very reason that the two classes aaa and bbb
have been coalesced together. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In a derived class, the
programmers initially call functions from the original base class. So, in
consonance with this ritual, the OnPaint function is called from the base class
UserControl using the reserved keyword 'base'. It is not mandatory to call the
base class function. However, if you have called this function, it is innocuous
and shall mean no harm to you. Moreover, things just do not work at times,
unless the original function is called. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The Brush object
LinearGradientBrush is created by assigning four parameters to the constructor,
i.e. two point objects and two colors. The points specify a starting and an
ending point of the rectangle. In our case, it begins at 0,0 and ends at the
length of our window. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In the a.txt file, the end X
axis value is 100 since the Size of the window is 100 pixels, as has been
stipulated by the Size property in the constructor. The height is 23 pixels as
is evident. The starting and the ending colors have been specified by the
variables se and ce, respectively. We could have used the properties 'start'
and 'end' instead, but we are in a mood to violate quite a few rules today! <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The FillRectangle function from
the Graphics class is used to fill up a rectangle named ClientRectangle. The
size of this rectangle indicates to us that it starts at 0,0 and has a width of
100 and height of 23, as the ClientSize point structure. This rectangle is
initialized by the Size property that has been set in the constructor. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Pause here and run the program.
If you have followed our instructions to the T, you should see two colors. The
starting color is Red, since the initial value of the variable cs is Red. The
color ends with Green, which is the value of the end color ce. Thus, the
LinearGradientBrush draws a gradient between two points with the two colors
that have been specified. This is how a spectacular visual effect can be
achieved by using the right brush. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Now, we shall add some more
color to the background. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The FillRectangle is used to
fill up the entire control. One more Rectangle r is created and the
ClientRectangle property is set.<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>At this juncture, the property
a1 has a value of 78. So, the freshly created variable p is assigned a value of
.78, which is obtained<span style="mso-spacerun: yes">  </span>simply by
dividing 78 by 100. The Width of the rectangle is multiplied by 100, thus
resulting in a value 78. Thus, the variable p is used as a percentage to
decrease the value of the Width of the window. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>We then add the X property of
the rectangle with this value of 'a'. The value of X is '0', thus resulting in
a value of 78. The Width, which is the distance from the start to the end, is
now reduced from 100 to 22, since 78 has been subtracted from it. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Then, a SolidBrush is created by
employing the color cf, which is the property called final. Once again, the
FillRectangle function is used to fill this rectangle r with a solid brush.<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>A point of substance here is
that the property a1 is used as a percentage, and by increasing the value of
the X axis by 78 and reducing the width by the same amount, the size of the
rectangle r has been reduced by 78%. Thus, 22% of the control will now be
soaked in blue color, or whichever color we have chosen for the property
'final'. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Also, the property a1 now
reflects the area, in percentage, of the control, and the UI editor that the
final color should not cover. If you were to increase its value, the first two
colors of the gradient would occupy more space. However, if you were to reduce
its value,<span style="mso-spacerun: yes">  </span>the property final color
shall swamp more real estate. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>It is the onus of the Flush
function to finally display a thing. We could ask the framework to ensure that
everything gets displayed. But, since this is such a time consuming process,
everything that needs to be displayed gets added to a buffer, until the buffer
is flushed. Unless the Flush function has been executed, there is no guarantee
that the items would be displayed. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>The remainder of the code
ascertains that the property textl has been displayed in the center of the window.
The DrawString function is used for this purpose. The only prerequisite here is
that the text must be centered, irrespective of the font and the size. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>To attain this, a RectangleF
object is created. This is a rectangle whose data types are floats and not
ints. Also, a SizeF object is created, which is a Size object with the data
type of floats. The next task is to ascertain the amount of space (both
vertically and horizontally), which shall be inhabited by the text in the
string property textl. The MeasureString function in the Graphics class is the
perfect panacea for our maladies. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>This function is furnished with
the string and the current Font, which has been returned as a SizeF object. The
Font object is determined by the property Fontl, which uses the variable f1 to
store the value of the property. In the Font that we are using, the string
'vijay' takes up 26 pixels horizontally and 13 pixels vertically.<span
style="mso-spacerun: yes">  </span><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thereafter, the Width and Height
of the r1 Rectangle are set to the Width and Height of the string. The X and Y
coordinates of the point from which the text is to be displayed, is the Width
of the window, minus the width of the text divided by two. This computation
ensures that the string gets aligned to the centre. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>With the help of the DrawString
function, this rectangle is used to determine where the text should be
displayed. Now, click on the drop-down listbox to behold a palette full of
colors. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>In order to change the
proportion of the color displayed, just click on any part of the window. The
MouseEventArgs parameter gives the X and Y coordinates of the mouse click. We
need to convert e.X into a percentage of the width of the window, to obtain the
value in the variable p. In our case, since the Width of the rectangle is 100,
both p and e.X share the same values.<span style="mso-spacerun: yes"> 
</span>The value of p is stored in a global variable dv. The Invalidate
function is called, so that the Paint message can redraw the window whenever
the drop-down listbox is clicked next. This spurs a fresh diffusion of colors. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>When the mouse button is
released, the function OnMouseUp gets called. In this function, the value of
the property a1 is initialized to dv. The use of variable dv is purely
optional. One could have used the property a1 in the function OnMouseDown
instead. It is the Invoke function that finally closes the drop-down listbox. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>As a final point, the new aaa
object must be initialized in the Edit Value function. It would display the
drop-down listbox embodying all the values of the control. This is imperative
since the control that is displayed and the control that is used in the
drop-down listbox, may belong to the same class aaa, but they are different
instances. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>Thus, all the properties from
the object 'a' must be transferred to the newly created object 't', or else the
properties that are newly initialized in the control, shall not be used by the
drop-down listbox. You may experiment by modifying the Font and the colors of
the properties. <o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'>You have covered considerable
ground so far. Have a break, since we feel that you truly deserve it!<o:p></o:p></span></p>

<p class=ILbase><span style='color:windowtext'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

</div>

</body>


<!-- Mirrored from www.vijaymukhi.com/documents/books/vs2net/chap2.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 11 Oct 2024 14:08:35 GMT -->
</html>
